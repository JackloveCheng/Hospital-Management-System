/*!
 * Raty - A Star Rating Plugin
 *
 * The MIT License
 *
 * author:  Washington Botelho
 * github:  wbotelhos/raty
 * version: 3.1.0
 *
*/ !function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(t.jQuery)}(this,function(t){"use strict";var e;t.raty={cancelButton:!1,cancelClass:"raty-cancel",cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:void 0,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:void 0,iconRangeSame:!1,mouseout:void 0,mouseover:void 0,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:void 0,precision:!1,readOnly:!1,round:{down:.25,full:.6,up:.76},score:void 0,scoreName:"score",single:!1,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",starType:"img",target:void 0,targetFormat:"{score}",targetKeep:!1,targetScore:void 0,targetText:"",targetType:"hint"},t.fn.raty=function(e){return this.each(function(){return new t.raty.Raty(this,e)._create()})},t.raty.Raty=((e=function(e,i){this.element=e,this.self=t(e),this.opt=t.extend(!0,{},t.raty,i,this.self.data())}).prototype={_create:function(){this._executeCallbacks(),this._adjustNumber(),this._adjustHints(),this.opt.score=this._adjustedScore(this.opt.score),"img"!==this.opt.starType&&this._adjustStarName(),this._setPath(),this._createStars(),this.opt.cancelButton&&this._createCancel(),this.opt.precision&&this._adjustPrecision(),this._createScore(),this._apply(this.opt.score),this._setTitle(this.opt.score),this._target(this.opt.score),this.opt.readOnly?this._lock():(this.element.style.cursor="pointer",this._binds()),this.self.data("raty",this)},_adjustedScore:function(t){if(t||0===t)return this._between(t,0,this.opt.number)},_adjustHints:function(){if(this.opt.hints||(this.opt.hints=[]),this.opt.halfShow||this.opt.half)for(var t=this.opt.precision?10:2,e=0;e<this.opt.number;e++){var i=this.opt.hints[e];"[object Array]"!==Object.prototype.toString.call(i)&&(i=[i]),this.opt.hints[e]=[];for(var s=0;s<t;s++){var o=i[s],n=i[i.length-1];void 0===n&&(n=null),this.opt.hints[e][s]=void 0===o?n:o}}},_adjustNumber:function(){this.opt.number=this._between(this.opt.number,1,this.opt.numberMax)},_adjustPrecision:function(){this.opt.half=!0},_adjustStarName:function(){var t=["cancelOff","cancelOn","starHalf","starOff","starOn"];this.opt.path="";for(var e=0;e<t.length;e++)this.opt[t[e]]=this.opt[t[e]].replace(".","-")},_apply:function(t){this._fill(t),t&&(t>0&&this.scoreField.val(t),this._roundStars(t))},_attributesForIndex:function(t){var e=this._nameForIndex(t),i={alt:t,src:this.opt.path+this.opt[e]};return"img"!==this.opt.starType&&(i={"data-alt":t,class:this.opt[e]}),i.title=this._getHint(t),i},_between:function(t,e,i){return Math.min(Math.max(parseFloat(t),e),i)},_binds:function(){this.cancelButton&&(this._bindOverCancel(),this._bindClickCancel(),this._bindOutCancel()),this._bindOver(),this._bindClick(),this._bindOut()},_bindClick:function(){var e=this;this.stars.on("click.raty",function(i){if(!e.self.data("readonly")){var s=!0,o=e.opt.half||e.opt.precision?e.self.data("score"):this.alt||t(this).data("alt");e.opt.half&&!e.opt.precision&&(o=e._roundHalfScore(o)),e.opt.click&&(s=e.opt.click.call(e.element,+o,i)),(s||void 0===s)&&e._apply(+o)}})},_bindClickCancel:function(){this.cancelButton.on("click.raty",(function(t){this.scoreField.removeAttr("value"),this.opt.click&&this.opt.click.call(this.element,null,t)}).bind(this))},_bindOut:function(){this.self.on("mouseleave.raty",(function(t){var e=+this.scoreField.val()||void 0;this._apply(e),this._target(e,t),this._resetTitle(),this.opt.mouseout&&this.opt.mouseout.call(this.element,e,t)}).bind(this))},_bindOutCancel:function(){var t=this;this.cancelButton.on("mouseleave.raty",function(e){var i=t.opt.cancelOff;if("img"!==t.opt.starType&&(i=t.opt.cancelClass+" "+i),t._setIcon(this,i),t.opt.mouseout){var s=+t.scoreField.val()||void 0;t.opt.mouseout.call(t.element,s,e)}})},_bindOver:function(){var t=this,e=t.opt.half?"mousemove.raty":"mouseover.raty";this.stars.on(e,function(e){var i=t._getScoreByPosition(e,this);t._fill(i),t.opt.half&&(t._roundStars(i,e),t._setTitle(i,e),t.self.data("score",i)),t._target(i,e),t.opt.mouseover&&t.opt.mouseover.call(t.element,i,e)})},_bindOverCancel:function(){var t=this;this.cancelButton.on("mouseover.raty",function(e){if(!t.self.data("readonly")){var i=t.opt.path+t.opt.starOff,s=t.opt.cancelOn;"img"===t.opt.starType?t.stars.attr("src",i):(s=t.opt.cancelClass+" "+s,t.stars.attr("class",i)),t._setIcon(this,s),t._target(null,e),t.opt.mouseover&&t.opt.mouseover.call(t.element,null)}})},_buildScoreField:function(){return t("<input />",{name:this.opt.scoreName,type:"hidden"}).appendTo(this.self)},_createCancel:function(){var e=this.opt.path+this.opt.cancelOff,i=t("<"+this.opt.starType+" />",{title:this.opt.cancelHint,class:this.opt.cancelClass});"img"===this.opt.starType?i.attr({src:e,alt:"x"}):i.attr("data-alt","x").addClass(e),"left"===this.opt.cancelPlace?this.self.prepend("&#160;").prepend(i):this.self.append("&#160;").append(i),this.cancelButton=i},_createScore:function(){var e=t(this.opt.targetScore);this.scoreField=e.length?e:this._buildScoreField()},_createStars:function(){for(var e=1;e<=this.opt.number;e++){var i=this._attributesForIndex(e);t("<"+this.opt.starType+" />",i).appendTo(this.element),this.opt.space&&e<this.opt.number&&this.self.append("&#160;")}this.stars=this.self.children(this.opt.starType)},_error:function(e){t(this).text(e),t.error(e)},_executeCallbacks:function(){for(var t=["number","readOnly","score","scoreName","target","path"],e=0;e<t.length;e++)if("function"==typeof this.opt[t[e]]){var i=this.opt[t[e]].call(this.element);i?this.opt[t[e]]=i:delete this.opt[t[e]]}},_fill:function(t){var e=0;if(this.opt.iconRangeSame&&this.opt.iconRange)for(;e<this.opt.iconRange.length&&this.opt.iconRange[e].range<t;)e++;for(var i=1;i<=this.stars.length;i++){var s,o=this.stars[i-1],n=this._turnOn(i,t);if(this.opt.iconRange&&this.opt.iconRange.length>e){var a=this.opt.iconRange[e];s=this._getRangeIcon(a,n),i<=a.range&&this._setIcon(o,s),i===a.range&&e++}else s=this.opt[n?"starOn":"starOff"],this._setIcon(o,s)}},_getDecimal:function(t,e){var i=t.toString().split(".")[1],s=0;return i&&(s=parseInt(i.slice(0,e),10),"9999"===i.slice(1,5)&&s++),s},_getRangeIcon:function(t,e){return e?t.on||this.opt.starOn:t.off||this.opt.starOff},_getScoreByPosition:function(e,i){var s=parseInt(i.alt||i.getAttribute("data-alt"),10);if(this.opt.half){var o=this._getWidth();s=s-1+parseFloat((e.pageX-t(i).offset().left)/o)}return s},_getHint:function(t,e){if(0!==t&&!t)return this.opt.noRatedMsg;var i=this._getDecimal(t,1),s=this.opt.hints[(Math.ceil(t)||1)-1],o=s,n=!e||this.isMove;return this.opt.precision?(n&&(i=0===i?9:i-1),o=s[i]):(this.opt.halfShow||this.opt.half)&&(o=s[i=n&&0===i?1:i>5?1:0]),""===o?"":o||t},_getWidth:function(){var t=this.stars[0].width||parseFloat(this.stars.eq(0).css("font-size"));return t||this._error("Could not get the icon width!"),t},_lock:function(){var t=this._getHint(this.scoreField.val());this.element.style.cursor="",this.element.title=t,this.scoreField.prop("readonly",!0),this.stars.prop("title",t),this.cancelButton&&this.cancelButton.hide(),this.self.data("readonly",!0)},_nameForIndex:function(t){return this.opt.score&&this.opt.score>=t?"starOn":"starOff"},_resetTitle:function(){for(var t=0;t<this.opt.number;t++)this.stars[t].title=this._getHint(t+1)},_roundHalfScore:function(t){var e=parseInt(t,10),i=this._getDecimal(t,1);return 0!==i&&(i=i>5?1:.5),e+i},_roundStars:function(t,e){var i=this._starName(t,e);if(i){var s=this.opt[i],o=this.stars[Math.ceil(t)-1];this._setIcon(o,s)}},_setIcon:function(t,e){t["img"===this.opt.starType?"src":"className"]=this.opt.path+e},_setPath:function(){this.opt.path=this.opt.path||"",this.opt.path&&"/"!==this.opt.path.slice(-1)[0]&&(this.opt.path+="/")},_setTarget:function(t,e){e&&(e=this.opt.targetFormat.toString().replace("{score}",e)),t.is(":input")?t.val(e):t.html(e)},_setTitle:function(t,e){if(t){var i=parseInt(Math.ceil(t),10);this.stars[i-1].title=this._getHint(t,e)}},_starName:function(t,e){var i=+(t%1).toFixed(2);return e||this.isMove?i>.5?"starOn":"starHalf":i<=this.opt.round.down?void 0:this.opt.halfShow&&i<this.opt.round.up?"starHalf":i<this.opt.round.full?"starOff":"starOn"},_target:function(e,i){if(this.opt.target){var s=t(this.opt.target);s.length||this._error("Target selector invalid or missing!");var o=i&&"mouseover"===i.type;if(void 0===e)e=this.opt.targetText;else if(null===e)e=o?this.opt.cancelHint:this.opt.targetText;else{"hint"===this.opt.targetType?e=this._getHint(e,i):this.opt.precision&&(e=parseFloat(e).toFixed(1));var n=i&&"mousemove"===i.type;o||n||this.opt.targetKeep||(e=this.opt.targetText)}this._setTarget(s,e)}},_turnOn:function(t,e){return this.opt.single?t===e:t<=e},_unlock:function(){this.element.style.cursor="pointer",this.element.removeAttribute("title"),this.scoreField.removeAttr("readonly"),this.self.data("readonly",!1),this._resetTitle(),this.cancelButton&&this.cancelButton.css("display","")},cancel:function(t){!0!==this.self.data("readonly")&&(this[t?"click":"score"].call(this,null),this.scoreField.removeAttr("value"))},click:function(e){!0!==this.self.data("readonly")&&(e=this._adjustedScore(e),this._apply(e),this.opt.click&&this.opt.click.call(this.element,e,t.Event("click")),this._target(e))},getScore:function(){var t,e=[];return e.push((t=this.scoreField.val())?+t:void 0),e.length>1?e:e[0]},move:function(e){var i=parseInt(e,10),s=this._getDecimal(e,1);i>=this.opt.number&&(i=this.opt.number-1,s=10);var o=this._getWidth(),n=t(this.stars[i]),a=n.offset().left+o/10*s,r=t.Event("mousemove",{pageX:a});this.isMove=!0,n.trigger(r),this.isMove=!1},readOnly:function(t){this.self.data("readonly")!==t&&(t?(this.self.off(".raty").children(this.opt.starType).off(".raty"),this._lock()):(this._binds(),this._unlock()),this.self.data("readonly",t))},score:function(){return arguments.length?this.setScore.apply(this,arguments):this.getScore()},setScore:function(t){!0!==this.self.data("readonly")&&(t=this._adjustedScore(t),this._apply(t),this._target(t))}},e)});